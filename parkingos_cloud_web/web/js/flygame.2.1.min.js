function startGame(){data=Utils.getData(),!Utils.resizeCanvas("game_canvas"),stage=new CoreStage("game_canvas",data),stage.loader.startLoad(),stage.startLoop()}function resumeGame(){Utils.isScore=!1,stage.bullets.bulletCount>0||Utils.noBullets()}var Point=function(a,b){this.x=a||0,this.y=b||0};Point.prototype.set=function(a,b){this.x=a||0,this.y=b||0};var Callback=function(a,b){this.func=a||function(){},this.ctx=b||null};Callback.prototype.c=function(a,b,c){this.func.call(this.ctx,a,b,c)};var Utils={scale:1,scaleReal:0,planeSpeed:1,STAGE_W:0,speedScale:0,STAGE_H:0,HALF_W:0,HALF_H:0,SLINGSHOT_W:0,SLINGSHOT_H:0,SLINGSHOT_X:0,SLINGSHOT_Y:0,BULLET_W:0,BULLET_H:0,BULLET_X:0,BULLET_Y:0,CLOTH_W:0,CLOTH_H:0,pathFactory:null,currentDistance:0,maxDistance:150,isTween:!1,isBullet:!1,isBulletFire:!1,pause:!1,radianToDegreesFactor:180/Math.PI,degreeToRadiansFactor:Math.PI/180,clearArray:function(a){for(;a.length>0;)a.pop()},radToDeg:function(a){return a*this.radianToDegreesFactor},degToRad:function(a){return a*this.degreeToRadiansFactor},angleBetweenPoints:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},distance:function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},velocityFromRotation:function(a,b,c){return void 0===b&&(b=60),c=c||new Point,c.set(Math.cos(a)*b,Math.sin(a)*b)},catmullRomInterpolation:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d);return a[0]===a[c]?(0>b&&(e=Math.floor(d=c*(1+b))),this.catmullRom(a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):0>b?a[0]-(this.catmullRom(a[0],a[0],a[1],a[1],-d)-a[0]):b>1?a[c]-(this.catmullRom(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):this.catmullRom(a[e?e-1:0],a[e],a[e+1>c?c:e+1],a[e+2>c?c:e+2],d-e)},catmullRom:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b},resizeCanvas:function(a){var b=Math.max(window.innerWidth,document.documentElement.clientWidth),c=Math.max(window.innerHeight,document.documentElement.clientHeight),d=document.getElementById(a);d.width=b,d.height=c,this.STAGE_W=b,this.STAGE_H=c;var e=b/1080;return this.scale=e>1?1:e,this.scaleReal=e,this.maxDistance*=this.scale,b>980},rectangleToRect:function(a){return new createjs.Graphics.Rect(a.x,a.y,a.width,a.height)}};Utils.isScore=!1,Utils.isDebug=!1,Utils.debugB=!1,Utils.debugF=!1,Utils.getData=function(){if(!Utils.isDebug)return getData();var a={bullet_count:5,plane_empty:8,plane_gift:3,plane_ticket:3,plane_cash:2,fly_bird:!0};return a},Utils.noBullets=function(){Utils.isDebug||Utils.isScore?console.log("bullet is null"):noBullets()},Utils.getScroe=function(a,b){Utils.isDebug?console.log("^_^ hit plane >> "+a):(Utils.isScore=!0,getScroe(a,b))},Utils.hitEmpty=function(){Utils.isDebug?console.log("hit empty plane - -"):hitEmpty()};var PlanePathFactory=function(a){this.baseY=200*Utils.scale,this.templatePoint=[],this.width=a,this.ty=60*Utils.scale,this.widthCount=9,this.paths=[];var b=this.width/(this.widthCount-1);this.templatePoint[-1]=new Array;for(var c=-4;c<this.widthCount+4;c++){var d={x:c*b,y:this.baseY-this.ty};this.templatePoint[-1][c]=d}this.templatePoint[0]=new Array;for(var c=-4;c<this.widthCount+4;c++){var d={x:c*b,y:this.baseY};this.templatePoint[0][c]=d}this.templatePoint[1]=new Array;for(var c=-4;c<this.widthCount+4;c++){var d={x:c*this.width/(this.widthCount-1),y:this.baseY+this.ty};this.templatePoint[1][c]=d}};PlanePathFactory.prototype.constructor=PlanePathFactory,PlanePathFactory.prototype.createPath=function(a){for(var b={x:[],y:[],paths:[]},c=0;c<a.v.length;c++){var d=this.templatePoint[a.v[c]][a.h[c]];b.x[c]=d.x,b.y[c]=d.y}return b},PlanePathFactory.prototype.getLevelPath=function(a,b){var c,d=this.paths[a],e={x:d.x.slice(0),y:d.y.slice(0),paths:d.paths.slice(0)},f=b*this.ty;for(c=0;c<e.y.length;c++)e.y[c]+=f;return e},PlanePathFactory.prototype.initPath=function(){var a,b,c=[{v:[0,-1,1,-1,1,-1,0,1,-1,1,-1,1,0],h:[-1,0,2,4,6,8,9,8,6,4,2,0,-1]},{v:[0,-1,1,-1,0,1,-1,1,0],h:[-1,1,4,7,9,7,4,1,-1]},{v:[0,-1,1,-1,0,1,-1,1,0],h:[-1,0,4,8,9,8,4,0,-1]},{v:[0,-1,1,-1,0,1,-1,1,0],h:[-1,0,5,8,9,8,3,0,-1]},{v:[0,-1,1,-1,0,1,-1,1,0],h:[-1,0,6,8,9,8,2,0,-1]},{v:[0,-1,1,-1,1,-1,1,0],h:[-1,0,7,8,9,2,1,-1]},{v:[0,-1,1,0,-1,1,0],h:[-1,0,8,9,8,0,-1]},{v:[0,-1,0,-1,1,-1,0,1,0,1,-1,1,0],h:[-1,0,1,2,5,8,9,8,7,6,3,1,-1]},{v:[0,-1,1,-1,1,0,-1,1,0,1,0],h:[-1,1,2,4,8,9,7,5,4,3,-1]}],d=c.length;for(a=0;d>a;a++)b=c[a],this.paths.push(this.createPath(b));var e={v:[0,-1,0,-1,0,-1,0,-1,0,-1,0],h:[-4,-2,1,5,8,12,8,5,1,-2,-4]};this.paths[-1]=this.createPath(e),Utils.clearArray(this.templatePoint)};var ResourceLoader=function(){createjs.LoadQueue.call(this,!0),this.ID_BG="bg",this.ID_SLINGSHOT="slingshot",this.ID_BULLET="bullet",this.ID_BULLET_COUNT="bullet_count",this.ID_PLANE_CASH="plane_cash",this.ID_PLANE_EMPTY="plane_empty",this.ID_PLANE_GIFT="plane_gift",this.ID_PLANE_TICKET="plane_ticket",this.ID_PLANE_BIRD="fly_bird",this.ID_CLOTH="cloth",this.manifest=[{src:"bg.png",id:this.ID_BG},{src:"slingshot.png",id:this.ID_SLINGSHOT},{src:"bullet.png",id:this.ID_BULLET},{src:"bullet_count.png",id:this.ID_BULLET_COUNT},{src:"cloth.png",id:this.ID_CLOTH},{src:"plane_cash.json",id:this.ID_PLANE_CASH,type:"spritesheet"},{src:"plane_empty.json",id:this.ID_PLANE_EMPTY,type:"spritesheet"},{src:"plane_gift.json",id:this.ID_PLANE_GIFT,type:"spritesheet"},{src:"plane_ticket.json",id:this.ID_PLANE_TICKET,type:"spritesheet"},{src:"birdsheet.json",id:this.ID_PLANE_BIRD,type:"spritesheet"}],this.basePath="images/flygame/"};ResourceLoader.prototype=Object.create(createjs.LoadQueue.prototype),ResourceLoader.prototype.constructor=ResourceLoader,ResourceLoader.prototype.startLoad=function(){this.loadManifest(this.manifest,!0,this.basePath)};var StaticContainer=function(){createjs.Container.call(this)};StaticContainer.prototype=Object.create(createjs.Container.prototype),StaticContainer.prototype.constructor=StaticContainer,StaticContainer.prototype.initChild=function(){var a=this.stage.loader,b=a.getResult(a.ID_BG),c=Utils.STAGE_W/b.width,d=Utils.STAGE_H/b.height;bg=new createjs.Bitmap(b),bg.setTransform(0,0,c,d),this.addChild(bg),b=a.getResult(a.ID_SLINGSHOT),Utils.SLINGSHOT_W=b.width*Utils.scale,Utils.SLINGSHOT_H=b.height*Utils.scale,Utils.SLINGSHOT_X=Utils.HALF_W,Utils.SLINGSHOT_Y=Utils.STAGE_H-300*Utils.scale;var e=new createjs.Bitmap(b);e.setTransform(Utils.SLINGSHOT_X,Utils.SLINGSHOT_Y,Utils.scale,Utils.scale),e.regX=b.width/2,e.regY=b.height/2,this.addChild(e)};var RubberContainer=function(){createjs.Container.call(this),this.rubber=new createjs.Shape,this.cloth=null,this.target=new Point,this.left=new Point,this.right=new Point,this.center=new Point,this.w=0,this.h=0,this.tweenComplete=function(){},this.tweenCompleteContext=this};RubberContainer.prototype=Object.create(createjs.Container.prototype),RubberContainer.prototype.constructor=RubberContainer,RubberContainer.prototype.initChild=function(){this.left.x=Utils.SLINGSHOT_X-Utils.SLINGSHOT_W/2+14*Utils.scale,this.left.y=Utils.SLINGSHOT_Y-Utils.SLINGSHOT_H/2+33*Utils.scale,this.right.x=Utils.SLINGSHOT_X+Utils.SLINGSHOT_W/2-13*Utils.scale,this.right.y=this.left.y;var a=this.stage.loader,b=a.getResult(a.ID_CLOTH);this.w=b.width,this.h=b.height,Utils.CLOTH_W=b.width*Utils.scale,Utils.CLOTH_H=b.height*Utils.scale,this.cloth=new createjs.Bitmap(b),this.target.x=Utils.BULLET_X,this.target.y=Utils.BULLET_Y,this.addChild(this.cloth),this.center.set(Utils.HALF_W,this.left.y),this.addChild(this.rubber),this.drawRubber()},RubberContainer.prototype.loop=function(a){},RubberContainer.prototype.drawRubber=function(a,b,c){var d=this.rubber.graphics;d.clear(),d.setStrokeStyle(10*Utils.scale,"round","round"),d.beginStroke("#F0F"),d.beginFill("#F0F"),b||(b=Math.PI/2),c||(c=0);var e=b-Math.PI/2;a&&(this.target=a);var f=Utils.BULLET_H/2+Utils.CLOTH_H/2-5*Utils.scale;this.target.x=this.target.x+f*Math.cos(b),this.target.y=this.target.y+f*Math.sin(b),d.beginStroke("#93690A"),d.beginFill("#93690A"),f=this.w/2-8,f*=Utils.scale,d.moveTo(this.left.x,this.left.y),d.lineTo(this.target.x-f*Math.cos(e),this.target.y-f*Math.sin(e)),d.moveTo(this.right.x,this.right.y),d.lineTo(this.target.x+f*Math.cos(e),this.target.y+f*Math.sin(e)),this.cloth.setTransform(this.target.x,this.target.y,Utils.scale,Utils.scale),this.cloth.rotation=Utils.radToDeg(e),this.cloth.regX=this.w/2,this.cloth.regY=this.h/2},RubberContainer.prototype.up=function(a){var b=this.target.x-this.center.x,c=this.target.y-this.center.y,d=new Point(this.center.x-b,this.center.y-c),e=new Point(this.center.x+b/2,this.center.y+c/2),f=new Point(this.center.x-b/2,this.center.y-c/2),g=new Point(Utils.BULLET_X,Utils.BULLET_Y),h=50+150*Utils.currentDistance/Utils.maxDistance,i=createjs.Tween.get(this.target).to({x:d.x,y:d.y},4*h).to({x:e.x,y:e.y},3*h).to({x:f.x,y:f.y},2*h).to({x:g.x,y:g.y},2.5*h);Utils.isTween=!0,i.on("change",function(){this.drawRubber()},this),i.call(this.tweenComplete,[],this.tweenCompleteContext)};var LoaderDOM=function(){this.text=document.createElement("div"),this.text.className="pre_load",this.text.innerHTML="正在进入游戏 ...",this.probg=document.createElement("div"),this.probg.className="progress_bg",this.pro=document.createElement("div"),this.pro.className="progress",this.start=0,this.flag=!1};LoaderDOM.prototype.add=function(){this.start=Date.now()},LoaderDOM.prototype.realAdd=function(){document.body.appendChild(this.text),document.body.appendChild(this.probg),document.body.appendChild(this.pro),this.flag=!0},LoaderDOM.prototype.destory=function(){this.flag&&(document.body.removeChild(this.text),document.body.removeChild(this.probg),document.body.removeChild(this.pro))},LoaderDOM.prototype.progress=function(a){if(this.pro.style.width=a+"px",!this.flag){var b=Date.now();b-this.start>500&&this.realAdd()}};var Planes=function(){createjs.Container.call(this),Utils.pathFactory=new PlanePathFactory(Utils.STAGE_W)};Planes.prototype=Object.create(createjs.Container.prototype),Planes.prototype.constructor=Planes,Planes.prototype.initChild=function(a){var b=this.stage.loader,c=null;if(a.fly_bird&&(c=new PaperPlane(b.ID_PLANE_BIRD,b,1,0),this.addChild(c)),a.plane_cash>0)for(var d=0;d<a.plane_cash;d++)c=new PaperPlane(b.ID_PLANE_CASH,b,2.5,0),this.addChild(c);if(a.plane_gift>0)for(var d=0;d<a.plane_gift;d++)c=new PaperPlane(b.ID_PLANE_GIFT,b,1.5,1),this.addChild(c);if(a.plane_empty>0&&(c=new PaperPlane(b.ID_PLANE_EMPTY,b,1,1),this.addChild(c),a.plane_empty--),a.plane_ticket>0)for(var d=0;d<a.plane_ticket;d++)c=new PaperPlane(b.ID_PLANE_TICKET,b,1.2,2),this.addChild(c);if(a.plane_empty>0&&(c=new PaperPlane(b.ID_PLANE_EMPTY,b,.8,1),this.addChild(c),a.plane_empty--),a.plane_empty>0)for(var d=0;d<a.plane_empty;d++)c=d%2==0?new PaperPlane(b.ID_PLANE_EMPTY,b,1,4):new PaperPlane(b.ID_PLANE_EMPTY,b,.8,5),this.addChild(c);Utils.pathFactory.initPath()},Planes.prototype.loop=function(a){var b,c=this.children.length;for(b=0;c>b;b++)this.getChildAt(b).loop(a)},Planes.prototype.show=function(){var a,b,c=this.children.length;for(a=0;c>a;a++)b=this.getChildAt(a),this.showOne(b)},Planes.prototype.showOne=function(a,b){var c,d,e=b||!1,f=Utils.pathFactory.paths.length,g=this.stage.loader;d=Math.floor(Math.random()*f),a.name==g.ID_PLANE_BIRD&&(d=-1),c=Utils.pathFactory.getLevelPath(d,a.level),a.show(c,e)},Planes.prototype.drawPath=function(a){for(var b=this.children.length,c=0;b>c;c++)this.getChildAt(c).drawPath(a)};var PaperPlane=function(a,b,c,d){var e=b.getResult(a);createjs.Sprite.call(this,e),this.x=0,this.y=0,this.scaleX=Utils.scale,this.scaleY=Utils.scale;var f=this.getTransformedBounds();this.regX=f.width/2,this.regY=f.height/2,this.setBounds(0+f.width/3,0+f.height/3,f.width/3,f.height/3),this.visible=!1,this.path=null,this.pi=0,this.w=f.width,this.h=f.height,this.name=a,this.lastPoint=null,this.speed=c||1,this.pathCount=Utils.STAGE_W/this.speed,console.log("pathCount = "+this.pathCount),this.level=d};PaperPlane.prototype=Object.create(createjs.Sprite.prototype),PaperPlane.prototype.constructor=PaperPlane,PaperPlane.prototype.loop=function(a){if(null!=this.path){var b=Utils.catmullRomInterpolation(this.path.x,this.pi/this.pathCount),c=Utils.catmullRomInterpolation(this.path.y,this.pi/this.pathCount),d=new Point(b,c),e=null===this.lastPoint?0:Utils.angleBetweenPoints(this.lastPoint,d);this.lastPoint=d,this.x=b,this.y=c,this.pi>this.pathCount/2?this.rotation=Utils.radToDeg(e-Math.PI):this.rotation=Utils.radToDeg(e),this.pi++,this.pi>=this.pathCount&&(this.pi=0),b>Utils.STAGE_W+this.w?this.gotoAndPlay("left"):b<0-this.w&&this.gotoAndPlay("right")}},PaperPlane.prototype.show=function(a,b){this.visible=!0,b?(this.pi=0,Utils.clearArray(this.path.paths),Utils.clearArray(this.path.x),Utils.clearArray(this.path.y)):this.pi=Math.floor(Math.random()*this.pathCount*2/4)+this.pathCount/4,this.path=a,this.pi<this.pathCount/2?this.gotoAndPlay("right"):this.pi>this.pathCount/2&&this.gotoAndPlay("left")},PaperPlane.prototype.drawPath=function(a){for(var b=0;b<this.path.paths.length;b++)a.rect(this.path.paths[b].x,this.path.paths[b].y,1,1);for(var b=0;b<this.path.x.length;b++)a.rect(this.path.x[b]-3,this.path.y[b]-3,6,6)},PaperPlane.prototype.getB=function(){var a,b,c,d=this.getTransformedBounds();return"fly_bird"==this.name,b=d.x+d.width/2-this.w/4,c=d.y+d.height/2-this.h/4,a=new createjs.Rectangle(b,c,this.w/2,this.h/2),a};var Bullet=function(a){createjs.Bitmap.call(this,a),this.speed=new Point(0,0),this.gravity=new Point(0,0),this.w=a.width,this.h=a.height,this.positionDown=new Point,this.position=new Point,this.cAngle=0,this.cDistance=0,this.maxDistance=Utils.maxDistance,this.baseSpeed=600,this.tspeed=1e3,this.baseGravityY=800,this.moveCallback=null,this.setBounds(this.w/10,this.h/10,4*this.w/5,4*this.h/5),this.isDown=!1};Bullet.prototype=Object.create(createjs.Bitmap.prototype),Bullet.prototype.constructor=Bullet,Bullet.prototype.loop=function(a){if(Utils.isBulletFire){var b=a.delta/1e3,c=this.speed.y*b+this.gravity.y*b*b/2;c*=Utils.speedScale,this.speed.x=this.speed.x+this.gravity.x*b,this.speed.y=this.speed.y+this.gravity.y*b,this.x=this.x+this.speed.x*b,this.y=this.y+c}},Bullet.prototype.down=function(a){this.isDown=!0,this.positionDown.set(a.stageX,a.stageY),this.position.set(a.stageX,a.stageY)},Bullet.prototype.up=function(a){Utils.currentDistance=this.cDistance,this.gravity.y=this.baseGravityY;var b=this.baseSpeed+this.cDistance*this.tspeed/this.maxDistance;Utils.velocityFromRotation(this.cAngle,-b,this.speed),Utils.isBulletFire=!0,console.log("speed y"+this.speed.y)},Bullet.prototype.move=function(a){this.isDown&&(this.position.set(a.stageX,a.stageY),this.cAngle=Utils.angleBetweenPoints(this.positionDown,this.position),this.cAngle<Math.PI/6||this.cAngle>5*Math.PI/6||(this.cDistance=Utils.distance(this.positionDown,this.position),this.cDistance=7*this.cDistance/18,this.cDistance=Math.min(this.cDistance,this.maxDistance),this.x=Utils.BULLET_X+Math.cos(this.cAngle)*this.cDistance,this.y=Utils.BULLET_Y+Math.sin(this.cAngle)*this.cDistance,null!=this.moveCallback&&this.moveCallback.c(new Point(this.x,this.y),this.cAngle,this.cDistance),this.rotation=Utils.radToDeg(this.cAngle-Math.PI/2)))},Bullet.prototype.reset=function(){this.speed=new Point(0,0),this.gravity=new Point(0,0),this.visible=!0,this.setTransform(Utils.BULLET_X,Utils.BULLET_Y,Utils.scale,Utils.scale),this.regX=this.w/2,this.regY=this.h/2,this.cDistance=0,this.cAngle=0,Utils.isBullet=!0,Utils.isBulletFire=!1},Bullet.prototype.getB=function(){return this.getTransformedBounds()};var Bullets=function(){createjs.Container.call(this),this.baseSpeed=20,this.cacheBullet=null,this.s=null,this.bulletHint=null,this.moveCallback=null,this.showCallback=null,this.bulletCount=0};Bullets.prototype=Object.create(createjs.Container.prototype),Bullets.prototype.constructor=Bullets,Bullets.prototype.initChild=function(a){this.bulletCount=a;var b=this.stage.loader;this.show();var c=b.getResult(b.ID_BULLET_COUNT),d=new createjs.Bitmap(c);d.x=100*Utils.scale,d.y=Utils.STAGE_H-80*Utils.scale,d.regX=c.width/2,d.regY=c.height/2,this.addChild(d),this.bulletHint=new createjs.Text(""+a,"38pt verdana","#000"),this.bulletHint.x=180*Utils.scale,this.bulletHint.y=d.y,this.bulletHint.regY=c.height/2,this.addChild(this.bulletHint)},Bullets.prototype.show=function(){var a,b,c=this.stage.loader;a=c.getResult(c.ID_BULLET),Utils.BULLET_W=a.width*Utils.scale,Utils.BULLET_H=a.height*Utils.scale,b=new Bullet(a),Utils.BULLET_X=Utils.SLINGSHOT_X,Utils.BULLET_Y=Utils.SLINGSHOT_Y-50*Utils.scale,b.setTransform(Utils.BULLET_X,Utils.BULLET_Y,Utils.scale,Utils.scale),b.visible=!1,this.addChild(b),b.moveCallback=this.moveCallback,this.cacheBullet=b,this.reShow(),this.showCallback,console.log("speed dis "+(Utils.BULLET_Y-Utils.pathFactory.baseY)),Utils.speedScale=(Utils.BULLET_Y-Utils.pathFactory.baseY)/1370},Bullets.prototype.reShow=function(){console.log("bullet count "+this.bulletCount),this.bulletCount<=0?(this.bulletCount=0,Utils.noBullets()):this.cacheBullet.reset()},Bullets.prototype.loop=function(a){null!=this.cacheBullet&&this.cacheBullet.loop(a),null!=this.bulletHint&&(this.bulletHint.text=""+this.bulletCount)},Bullets.prototype.down=function(a){null!=this.cacheBullet&&this.cacheBullet.down(a)},Bullets.prototype.up=function(a){null!=this.cacheBullet&&this.cacheBullet.up(a)},Bullets.prototype.move=function(a){null!=this.cacheBullet&&this.cacheBullet.move(a)};var CoreStage=function(a,b){createjs.Stage.call(this,a),Utils.STAGE_W=this.canvas.width,Utils.STAGE_H=this.canvas.height,Utils.HALF_W=Utils.STAGE_W/2,Utils.HALF_H=Utils.STAGE_H/2,this.data=b,this.loader=new ResourceLoader,this.loader.on("complete",this.initChild,this),this.loader.on("progress",this.pro,this),this.staticContainer=new StaticContainer,this.bullets=new Bullets,this.planes=new Planes,this.rubber=new RubberContainer,this.debugShape=new createjs.Shape,this.pathShape=new createjs.Shape,this.loaddom=new LoaderDOM,this.fps=new createjs.Text("","36px Arial","#777"),this.movetext=new createjs.Text("","26px Arial","#777"),this.loadWidth=.7*Utils.STAGE_W,this.preLoad()};CoreStage.prototype=Object.create(createjs.Stage.prototype),CoreStage.prototype.constructor=CoreStage,CoreStage.prototype.initChild=function(){this.loaddom.destory(),this.addChild(this.staticContainer),this.staticContainer.initChild(),this.addChild(this.bullets),this.bullets.initChild(this.data.bullet_count),this.addChild(this.planes),this.planes.initChild(this.data),this.planes.show(),this.addChild(this.rubber),this.rubber.initChild(),Utils.debugF&&(this.fps.x=Utils.HALF_W,this.fps.y=50,this.addChild(this.fps)),Utils.isDebug&&(this.movetext.x=100,this.movetext.y=100,this.addChild(this.movetext),this.addChild(this.debugShape)),this.update()},CoreStage.prototype.startLoop=function(){createjs.Ticker.framerate=60,createjs.Ticker.on("tick",this.loop,this),createjs.Touch.enable(this,!0),this.on("stagemousedown",this.down,this),this.on("stagemouseup",this.up,this),this.on("stagemousemove",this.move,this);var a=function(a,b,c){this.rubber.drawRubber(a,b,c)};this.bullets.moveCallback=new Callback(a,this),this.bullets.showCallback=new Callback(a,this),this.rubber.tweenComplete=function(){Utils.isTween=!1,Utils.isBullet||this.bullets.reShow()},this.rubber.tweenCompleteContext=this},CoreStage.prototype.loop=function(a){Utils.pause||(this.bullets.loop(a),this.planes.loop(a),this.update(a),Utils.debugB&&this.debug(),Utils.debugF&&(this.fps.text="fps:"+createjs.Ticker.getMeasuredFPS().toFixed(2)),Utils.isBulletFire&&(this.overlap(),this.checkOutBounds()))},CoreStage.prototype.down=function(a){a.stageY<2*Utils.STAGE_H/3||Utils.isBulletFire||Utils.isScore||this.bullets.down(a)},CoreStage.prototype.up=function(a){this.bullets.cacheBullet.positionDown.y<2*Utils.STAGE_H/3||this.bullets.cacheBullet.position.y<2*Utils.STAGE_H/3||Utils.isBulletFire||Utils.isScore||(this.bullets.up(a),this.rubber.up(a))},CoreStage.prototype.move=function(a){Utils.isBulletFire||Utils.isScore||this.bullets.move(a)},CoreStage.prototype.overlap=function(){var a,b,c=this.bullets.cacheBullet,d=this.planes.children;if(null!=c&&null!=d&&Array.isArray(d)&&d.length>0)for(a=0;a<d.length;a++)if(b=d[a],c.visible&&b.visible&&c.getB().intersects(b.getB()))return console.log("overlap"),c.visible=!1,b.visible=!1,Utils.isBullet=!1,this.bullets.bulletCount--,Utils.isTween||this.bullets.reShow(),this.planes.showOne(b,!0),void(b.name==this.loader.ID_PLANE_EMPTY?Utils.hitEmpty():Utils.getScroe(b.name,this.bullets.bulletCount))},CoreStage.prototype.checkOutBounds=function(){var a=this.bullets.cacheBullet;if(null!=a&&a.visible){var b=a.getTransformedBounds();(b.x+b.width<0||b.y+b.height<0||b.x>Utils.STAGE_W||b.y>Utils.STAGE_H)&&(console.log("bullet is outbounds!!"),a.visible=!1,Utils.isBullet=!1,this.bullets.bulletCount--,Utils.isTween||this.bullets.reShow())}},CoreStage.prototype.debug=function(){var a=this.debugShape.graphics;a.clear(),a.setStrokeStyle(1,"round","round"),a.beginStroke("#F0F");var b,c,d=this.planes.children;if(null!=d){if(Array.isArray(d)&&d.length>0)for(b=0;b<d.length;b++)c=d[b],c.visible&&a.append(Utils.rectangleToRect(c.getB()));null!=this.bullets.cacheBullet&&this.bullets.cacheBullet.visible&&a.append(Utils.rectangleToRect(this.bullets.cacheBullet.getB()))}},CoreStage.prototype.debugDrawPath=function(){var a=this.pathShape.graphics;a.setStrokeStyle(1,"round","round"),a.beginStroke("#01DF01"),this.planes.drawPath(a),a.rect(Utils.STAGE_W/2,0,1,Utils.STAGE_H),a.beginStroke("#DF013A"),a.rect(Utils.SLINGSHOT_X,Utils.SLINGSHOT_Y,3,3)},CoreStage.prototype.preLoad=function(){this.loaddom.add()},CoreStage.prototype.pro=function(a){var b=a.loaded*(this.loadWidth-30)+30;this.loaddom.progress(b)};var stage,data;Utils.isDebug&&(window.onload=function(){startGame()});