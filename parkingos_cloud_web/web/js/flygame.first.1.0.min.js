/*! complie time  2015-10-24_18-36-15 */ 
function startGame(){data=Utils.getData(),!Utils.resizeCanvas("game_canvas"),stage=new CoreStage("game_canvas",data),stage.startLoop()}function resumeGame(){Utils.isScore=!1}var Point=function(a,b){this.x=a||0,this.y=b||0};Point.prototype.set=function(a,b){this.x=a||0,this.y=b||0};var Callback=function(a,b){this.func=a||function(){},this.ctx=b||null};Callback.prototype.c=function(a,b,c){this.func.call(this.ctx,a,b,c)};var Utils={scale:1,scaleReal:0,planeSpeed:1,STAGE_W:0,speedScale:0,STAGE_H:0,HALF_W:0,HALF_H:0,SLINGSHOT_W:0,SLINGSHOT_H:0,SLINGSHOT_X:0,SLINGSHOT_Y:0,BULLET_W:0,BULLET_H:0,BULLET_X:0,BULLET_Y:0,CLOTH_W:0,CLOTH_H:0,pathFactory:null,currentDistance:0,maxDistance:150,isTween:!1,isBullet:!1,isBulletFire:!1,pause:!1,radianToDegreesFactor:180/Math.PI,degreeToRadiansFactor:Math.PI/180,clearArray:function(a){for(;a.length>0;)a.pop()},radToDeg:function(a){return a*this.radianToDegreesFactor},degToRad:function(a){return a*this.degreeToRadiansFactor},angleBetweenPoints:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},distance:function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},velocityFromRotation:function(a,b,c){return void 0===b&&(b=60),c=c||new Point,c.set(Math.cos(a)*b,Math.sin(a)*b)},catmullRomInterpolation:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d);return a[0]===a[c]?(0>b&&(e=Math.floor(d=c*(1+b))),this.catmullRom(a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):0>b?a[0]-(this.catmullRom(a[0],a[0],a[1],a[1],-d)-a[0]):b>1?a[c]-(this.catmullRom(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):this.catmullRom(a[e?e-1:0],a[e],a[e+1>c?c:e+1],a[e+2>c?c:e+2],d-e)},catmullRom:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b},resizeCanvas:function(a){var b=Math.max(window.innerWidth,document.documentElement.clientWidth),c=Math.max(window.innerHeight,document.documentElement.clientHeight);console.log("width "+b);var d=document.getElementById(a);d.width=b,d.height=c,this.STAGE_W=b,this.STAGE_H=c;var e=b/1080;return this.scale=e>1?1:e,this.scaleReal=e,this.maxDistance*=this.scale,b>980},rectangleToRect:function(a){return new createjs.Graphics.Rect(a.x,a.y,a.width,a.height)}};Utils.isScore=!1,Utils.isDebug=!1,Utils.debugB=!1,Utils.debugF=!1,Utils.getData=function(){if(!Utils.isDebug)return getData();var a={bullet_count:30,bullet_gold_count:5,plane_empty:0,plane_gift:0,plane_ticket:0,plane_cash:1,fly_bird:!0};return a},Utils.noBullets=function(){console.log(" bullet is empty"),Utils.isDebug||Utils.isScore||noBullets()},Utils.getScroe=function(a,b,c){return console.log("^_^ hit >> "+a+", stone count >> "+b+" gold count >> "+c),Utils.isDebug?!0:(Utils.isScore=!0,getScroe(a,b,c))},Utils.hitEmpty=function(a,b){console.log("hit empty plane - -, stone count >> "+a+" gold count >> "+b),Utils.isDebug||hitEmpty(a,b)},Utils.slingshotDie=function(){Utils.pause=!0,Utils.isDebug||slingshotDie()};var PlanePathFactory=function(a){this.baseY=200*Utils.scale,this.templatePoint=[],this.width=a,this.ty=60*Utils.scale,this.widthCount=9,this.paths=[];var b=this.width/(this.widthCount-1);this.templatePoint[-1]=new Array;for(var c=-4;c<this.widthCount+4;c++){var d={x:c*b,y:this.baseY-this.ty};this.templatePoint[-1][c]=d}this.templatePoint[0]=new Array;for(var c=-4;c<this.widthCount+4;c++){var d={x:c*b,y:this.baseY};this.templatePoint[0][c]=d}this.templatePoint[1]=new Array;for(var c=-4;c<this.widthCount+4;c++){var d={x:c*this.width/(this.widthCount-1),y:this.baseY+this.ty};this.templatePoint[1][c]=d}};PlanePathFactory.prototype.constructor=PlanePathFactory,PlanePathFactory.prototype.createPath=function(a){for(var b={x:[],y:[],paths:[]},c=0;c<a.v.length;c++){var d=this.templatePoint[a.v[c]][a.h[c]];b.x[c]=d.x,b.y[c]=d.y}return b},PlanePathFactory.prototype.getLevelPath=function(a,b){var c,d=this.paths[a],e={x:d.x.slice(0),y:d.y.slice(0),paths:d.paths.slice(0)},f=b*this.ty;for(c=0;c<e.y.length;c++)e.y[c]+=f;return e},PlanePathFactory.prototype.initPath=function(){var a,b,c=[{v:[0,-1,1,-1,1,-1,0,1,-1,1,-1,1,0],h:[-1,0,2,4,6,8,9,8,6,4,2,0,-1]},{v:[0,-1,1,-1,0,1,-1,1,0],h:[-1,1,4,7,9,7,4,1,-1]},{v:[0,-1,1,-1,0,1,-1,1,0],h:[-1,0,4,8,9,8,4,0,-1]},{v:[0,-1,1,-1,0,1,-1,1,0],h:[-1,0,5,8,9,8,3,0,-1]},{v:[0,-1,1,-1,0,1,-1,1,0],h:[-1,0,6,8,9,8,2,0,-1]},{v:[0,-1,1,-1,1,-1,1,0],h:[-1,0,7,8,9,2,1,-1]},{v:[0,-1,1,0,-1,1,0],h:[-1,0,8,9,8,0,-1]},{v:[0,-1,0,-1,1,-1,0,1,0,1,-1,1,0],h:[-1,0,1,2,5,8,9,8,7,6,3,1,-1]},{v:[0,-1,1,-1,1,0,-1,1,0,1,0],h:[-1,1,2,4,8,9,7,5,4,3,-1]}],d=c.length;for(a=0;d>a;a++)b=c[a],this.paths.push(this.createPath(b));var e={v:[0,-1,0,-1,0,-1,0,-1,0,-1,0],h:[-4,-2,1,5,8,12,8,5,1,-2,-4]};this.paths[-1]=this.createPath(e),Utils.clearArray(this.templatePoint)};var ResourceLoader=function(){createjs.LoadQueue.call(this,!0),this.ID_BG="bg",this.ID_SLINGSHOT="slingshot",this.ID_BULLET="bullet",this.ID_BULLET_GOLD="bullet_gold",this.ID_BULLET_COUNT="bullet_count",this.ID_BULLET_GOLD_COUNT="bullet_gold_count",this.ID_PLANE_CASH="plane_cash",this.ID_PLANE_EMPTY="plane_empty",this.ID_PLANE_GIFT="plane_gift",this.ID_PLANE_TICKET="plane_ticket",this.ID_PLANE_BIRD="fly_bird",this.ID_CLOTH="cloth",this.ID_CLOUD="cloud",this.ID_POINTER="pointer",this.ID_CROW="crow",this.ID_SHIT="shit",this.ID_CRAZY_PLANE="crazy_plane",this.ID_CRAZY_BIRD="crazy_bird",this.ID_BANG="bang",this.ID_SCORE="score",this.manifest=[{src:"bg.png",id:this.ID_BG},{src:"bullet.png",id:this.ID_BULLET},{src:"bullet_gold.png",id:this.ID_BULLET_GOLD},{src:"bullet_count.png",id:this.ID_BULLET_COUNT},{src:"bullet_gold_count.png",id:this.ID_BULLET_GOLD_COUNT},{src:"cloth.png",id:this.ID_CLOTH},{src:"cloud.png",id:this.ID_CLOUD},{src:"pointer.png",id:this.ID_POINTER},{src:"shit.png",id:this.ID_SHIT},{src:"plane_cash.json",id:this.ID_PLANE_CASH,type:"spritesheet"},{src:"plane_empty.json",id:this.ID_PLANE_EMPTY,type:"spritesheet"},{src:"plane_gift.json",id:this.ID_PLANE_GIFT,type:"spritesheet"},{src:"plane_ticket.json",id:this.ID_PLANE_TICKET,type:"spritesheet"},{src:"birdsheet.json",id:this.ID_PLANE_BIRD,type:"spritesheet"},{src:"slingshot_sheet.json",id:this.ID_SLINGSHOT,type:"spritesheet"},{src:"crow_sheet.json",id:this.ID_CROW,type:"spritesheet"},{src:"crazy_plane.json",id:this.ID_CRAZY_PLANE,type:"spritesheet"},{src:"crazy_bird.json",id:this.ID_CRAZY_BIRD,type:"spritesheet"},{src:"bang.json",id:this.ID_BANG,type:"spritesheet"}],this.basePath="images/flygame/"};ResourceLoader.prototype=Object.create(createjs.LoadQueue.prototype),ResourceLoader.prototype.constructor=ResourceLoader,ResourceLoader.prototype.startLoad=function(){this.loadManifest(this.manifest,!0,this.basePath)};var SlingShot=function(a){var b=a.getResult(a.ID_SLINGSHOT);createjs.Sprite.call(this,b,"normal");var c=this.getTransformedBounds();console.log(c.toString()),this.w=c.width,this.h=c.height,this.regX=c.width/2,this.regY=c.height/2,this.x=Utils.HALF_W,this.y=Utils.STAGE_H-300*Utils.scale,this.life=new Life(100,!1,-10),this.life.setPosition(this.x,this.y+this.h/2),this.life.show();var d=this;this.life.setOnclick(function(){d.test()})};SlingShot.prototype=Object.create(createjs.Sprite.prototype),SlingShot.prototype.constructor=SlingShot,SlingShot.prototype.getB=function(){var a,b,c,d;return a=this.getTransformedBounds(),c=a.x,d=a.y+a.height/2,b=new createjs.Rectangle(c,d,this.w,this.h/2)},SlingShot.prototype.hit=function(a){a.visible=!1,this.loss(a.power),console.log(a.name+" hit slingshot, hp > "+this.life.hp)},SlingShot.prototype.loss=function(a){var b=this.life.loss(a);0==b?this.gotoAndPlay("normal"):-1==b?this.gotoAndPlay("yellow"):-2==b&&this.gotoAndPlay("red"),this.life.isDie()&&(console.log("slingshot is die!!!!"),Utils.slingshotDie())},SlingShot.prototype.test=function(){console.log("slingshot life hp >> "+this.life.hp)};var Score=function(a){createjs.Container.call(this);var b=new createjs.Bitmap(a);b.regX=a.width/2,b.regY=a.height/2,b.visible=!1,this.addChild(b);var c=new createjs.Text("90","38pt verdana","#000");c.y=b.y,c.regY=a.height/2,c.visible=!1,this.addChild(c),this.scoreW=a.width,this.score=b,this.hint=c};Score.prototype=Object.create(createjs.Container.prototype),Score.prototype.constructor=Score,Score.prototype.show=function(a,b){this.score.x=a,this.score.y=this.hint.y=b,this.hint.x=a+this.scoreW/2+10,this.score.visible=!0,this.hint.visible=!0},Score.prototype.setText=function(a){this.hint.text=a};var StaticContainer=function(){createjs.Container.call(this),this.slingshot=null,this.bang=null,this.score=null};StaticContainer.prototype=Object.create(createjs.Container.prototype),StaticContainer.prototype.constructor=StaticContainer,StaticContainer.prototype.initChild=function(){var a=this.stage.loader,b=a.getResult(a.ID_BG),c=Utils.STAGE_W/b.width,d=Utils.STAGE_H/b.height,e=new createjs.Bitmap(b);e.setTransform(0,0,c,d),this.addChild(e),Utils.SLINGSHOT_X=Utils.HALF_W,Utils.SLINGSHOT_Y=Utils.STAGE_H-300*Utils.scale;var f=new SlingShot(a);console.log("slingshot width = "+f.w),console.log("scale = "+Utils.scale),Utils.SLINGSHOT_W=f.w*Utils.scale,Utils.SLINGSHOT_H=f.h*Utils.scale,this.addChild(f),this.slingshot=f;var g=a.getResult(a.ID_BANG),h=new createjs.Sprite(g,"bang");h.visible=!1,h.regX=g.getFrameBounds(0).width/2,h.regY=g.getFrameBounds(0).height,h.x=Utils.SLINGSHOT_X,h.y=Utils.SLINGSHOT_Y,h.alpha=0,this.addChild(h),this.bang=h},StaticContainer.prototype.overlap=function(a){a.overlap(this.slingshot)&&(this.slingshot.hit(a),(a.name==this.stage.loader.ID_CRAZY_PLANE||a.name==this.stage.loader.ID_CRAZY_BIRD)&&this.showBangTween(a.name))},StaticContainer.prototype.showBangTween=function(a){var b=400;a==this.stage.loader.ID_CRAZY_BIRD&&(b=800),this.bang.visible=!0,createjs.Tween.get(this.bang).to({alpha:1},b,createjs.Ease.getPowIn(2)).wait(b).to({alpha:0},b,createjs.Ease.getPowOut(2)).call(function(){})};var RubberContainer=function(){createjs.Container.call(this),this.rubber=new createjs.Shape,this.cloth=null,this.target=new Point,this.left=new Point,this.right=new Point,this.center=new Point,this.w=0,this.h=0,this.tweenComplete=function(){},this.tweenCompleteContext=this};RubberContainer.prototype=Object.create(createjs.Container.prototype),RubberContainer.prototype.constructor=RubberContainer,RubberContainer.prototype.initChild=function(){this.left.x=Utils.SLINGSHOT_X-Utils.SLINGSHOT_W/2+36*Utils.scale,this.left.y=Utils.SLINGSHOT_Y-Utils.SLINGSHOT_H/2+46*Utils.scale,this.right.x=Utils.SLINGSHOT_X+Utils.SLINGSHOT_W/2-36*Utils.scale,this.right.y=this.left.y;var a=this.stage.loader,b=a.getResult(a.ID_CLOTH);this.w=b.width,this.h=b.height,Utils.CLOTH_W=b.width*Utils.scale,Utils.CLOTH_H=b.height*Utils.scale,this.cloth=new createjs.Bitmap(b),this.target.x=Utils.BULLET_X,this.target.y=Utils.BULLET_Y,this.addChild(this.cloth),this.center.set(Utils.HALF_W,this.left.y),this.addChild(this.rubber),this.drawRubber()},RubberContainer.prototype.loop=function(a){},RubberContainer.prototype.drawRubber=function(a,b,c){var d=this.rubber.graphics;d.clear(),d.setStrokeStyle(10*Utils.scale,"round","round"),d.beginStroke("#F0F"),d.beginFill("#F0F"),b||(b=Math.PI/2),c||(c=0);var e=b-Math.PI/2;a&&(this.target=a);var f=Utils.BULLET_H/2+Utils.CLOTH_H/2-5*Utils.scale;this.target.x=this.target.x+f*Math.cos(b),this.target.y=this.target.y+f*Math.sin(b),d.beginStroke("#93690A"),d.beginFill("#93690A"),f=this.w/2-8,f*=Utils.scale,d.moveTo(this.left.x,this.left.y),d.lineTo(this.target.x-f*Math.cos(e),this.target.y-f*Math.sin(e)),d.moveTo(this.right.x,this.right.y),d.lineTo(this.target.x+f*Math.cos(e),this.target.y+f*Math.sin(e)),this.cloth.setTransform(this.target.x,this.target.y,Utils.scale,Utils.scale),this.cloth.rotation=Utils.radToDeg(e),this.cloth.regX=this.w/2,this.cloth.regY=this.h/2},RubberContainer.prototype.up=function(a){var b=this.target.x-this.center.x,c=this.target.y-this.center.y,d=new Point(this.center.x-b,this.center.y-c),e=new Point(this.center.x+b/2,this.center.y+c/2),f=new Point(this.center.x-b/2,this.center.y-c/2),g=new Point(Utils.BULLET_X,Utils.BULLET_Y),h=35+75*Utils.currentDistance/Utils.maxDistance,i=createjs.Tween.get(this.target).to({x:d.x,y:d.y},4*h).to({x:e.x,y:e.y},3*h).to({x:f.x,y:f.y},2*h).to({x:g.x,y:g.y},2.5*h);Utils.isTween=!0,i.on("change",function(){this.drawRubber()},this),i.call(this.tweenComplete,[],this.tweenCompleteContext)};var LoaderDOM=function(){this.text=document.createElement("div"),this.text.className="pre_load",this.text.innerHTML="正在进入游戏 ...",this.probg=document.createElement("div"),this.probg.className="progress_bg",this.pro=document.createElement("div"),this.pro.className="progress",this.start=0,this.flag=!1};LoaderDOM.prototype.add=function(){this.start=Date.now()},LoaderDOM.prototype.realAdd=function(){document.body.appendChild(this.text),document.body.appendChild(this.probg),document.body.appendChild(this.pro),this.flag=!0},LoaderDOM.prototype.destory=function(){this.flag&&(document.body.removeChild(this.text),document.body.removeChild(this.probg),document.body.removeChild(this.pro))},LoaderDOM.prototype.progress=function(a){if(this.pro.style.width=a+"px",!this.flag){var b=Date.now();b-this.start>500&&this.realAdd()}};var Life=function(a,b,c){this.lifeBg=document.createElement("div"),this.lifeBg.className="life_bg",this.lifeProBg=document.createElement("div"),this.lifeProBg.className="life_border_bg",this.lifePro=document.createElement("div"),this.lifePro.className="life_pro",this.lifeProBg.appendChild(this.lifePro),this.lifeBg.appendChild(this.lifeProBg),this.fixImg=document.createElement("img"),this.fixImg.style.position="absolute",this.fixImg.style.opacity=0,this.fixImg.src="images/flygame/fix_tip.png",this.hp=a,this.maxHp=a,this.w=220,this.h=38,this.proW=190,this.offset=10,this.lastState=0,this.state=0,this.lassLoss=0,this.target=null,this.isTween=!1,this.isHide=!1,this.fixShow=!1,b&&(this.fixShow=b),c&&(this.offset=c),this.lifeBg.onclick=function(){console.log("onClick")}};Life.prototype.setTarget=function(a){this.target=a},Life.prototype.setOnclick=function(a){this.lifeBg.onclick=a},Life.prototype.getRate=function(){return this.hp/this.maxHp},Life.prototype.getLastLossRate=function(){return this.lassLoss/this.maxHp},Life.prototype.isDie=function(){return this.hp<=0?(this.isTween||this.hide(),!0):!1},Life.prototype.show=function(){document.body.appendChild(this.lifeBg),this.fixShow&&document.body.appendChild(this.fixImg),this.loss(0,!0)},Life.prototype.hide=function(){this.isHide||(this.isHide=!0,this.lifeBg.style.opacity=0,null!=this.target&&(console.log("target invisible!!"),this.target.visible=!1))},Life.prototype.reShow=function(a,b){this.lifeBg.style.opacity=1,this.setPosition(a,b),this.hp=this.maxHp,this.loss(0),this.isHide=!1},Life.prototype.setPosition=function(a,b){var c=a-this.w/2,d=b+this.offset;this.lifeBg.style.top=d+"px",this.lifeBg.style.left=c+"px";var e=c+this.w+10,f=d-53;this.fixImg.style.top=f+"px",this.fixImg.style.left=e+"px"},Life.prototype.loss=function(a,b){return a&&(this.hp-=a,this.lassLoss=a),b||this.showTween(),this.changeState()},Life.prototype.changeState=function(){var a=this.getRate();if(a>2/3&&1>=a?(this.state=0,this.lifePro.style.backgroundColor="#95c955"):2/3>=a&&a>1/3?(this.state=-1,this.lifePro.style.backgroundColor="#fee689"):(this.state=-2,this.lifePro.style.backgroundColor="#ff6068"),this.lastState!=this.state){console.log("show tip");var b=createjs.Tween.get({opacity:0}).to({opacity:1},1e3,createjs.Ease.getPowIn(2));b.on("change",function(a){var b=a.target.target.opacity;this.fixImg.style.opacity=b},this),b.call(function(){}),this.lastState=this.state}else this.fixImg.style.opacity=0;return this.state},Life.prototype.showTween=function(){var a=this.getRate(),b=this.proW*a,c=1e3*this.getLastLossRate(),d=this.lifePro.clientWidth,e=createjs.Tween.get({width:d}).to({width:b},c,createjs.Ease.getPowOut(2));this.isTween=!0,e.on("change",function(a){var b=a.target.target.width;this.lifePro.style.width=b+"px"},this),e.call(function(){this.isTween=!1,this.isDie()},[],this)};var Planes=function(){createjs.Container.call(this),Utils.pathFactory=new PlanePathFactory(Utils.STAGE_W),this.crazy=null,this.crazyBird=null,this.crazyPlane=null,this.crow=null,this.shit=null};Planes.prototype=Object.create(createjs.Container.prototype),Planes.prototype.constructor=Planes,Planes.prototype.initChild=function(a){var b=this.stage.loader,c=new Crow(b.ID_CROW,b,this.shit);this.addChild(c),this.crow=c;var d=new CrazyPlane(b.ID_CRAZY_PLANE,b),e=new CrazyPlane(b.ID_CRAZY_BIRD,b);this.addChild(d),this.addChild(e),this.crazyBird=e,this.crazyPlane=d;var f=null;if(a.fly_bird&&(f=new PaperPlane(b.ID_PLANE_BIRD,b,1,0),this.addChild(f)),a.plane_cash>0)for(var g=0;g<a.plane_cash;g++)f=new PaperPlane(b.ID_PLANE_CASH,b,5,0),this.addChild(f);if(a.plane_gift>0)for(var g=0;g<a.plane_gift;g++)f=new PaperPlane(b.ID_PLANE_GIFT,b,1.5,1),this.addChild(f);if(a.plane_empty>0&&(f=new PaperPlane(b.ID_PLANE_EMPTY,b,1,1),this.addChild(f),a.plane_empty--),a.plane_ticket>0)for(var g=0;g<a.plane_ticket;g++)f=new PaperPlane(b.ID_PLANE_TICKET,b,2,2),this.addChild(f);if(a.plane_empty>0&&(f=new PaperPlane(b.ID_PLANE_EMPTY,b,.8,1),this.addChild(f),a.plane_empty--),a.plane_empty>0)for(var g=0;g<a.plane_empty;g++)f=g%2==0?new PaperPlane(b.ID_PLANE_EMPTY,b,1,4):new PaperPlane(b.ID_PLANE_EMPTY,b,.8,5),this.addChild(f);Utils.pathFactory.initPath(),this.show()},Planes.prototype.loop=function(a){var b,c,d=this.children.length;for(b=0;d>b;b++)c=this.getChildAt(b),c.visible&&c.loop(a)},Planes.prototype.show=function(){var a,b,c=this.children.length;for(a=0;c>a;a++)b=this.getChildAt(a),this.showOne(b)},Planes.prototype.showOne=function(a,b){if(a.name!=this.stage.loader.ID_CROW&&a.name!=this.stage.loader.ID_CRAZY_PLANE&&a.name!=this.stage.loader.ID_CRAZY_BIRD){var c,d,e=b||!1,f=Utils.pathFactory.paths.length,g=this.stage.loader;d=Math.floor(Math.random()*f),a.name==g.ID_PLANE_BIRD&&(d=-1),c=Utils.pathFactory.getLevelPath(d,a.level),a.show(c,e)}},Planes.prototype.drawPath=function(a){for(var b=this.children.length,c=0;b>c;c++)this.getChildAt(c).drawPath(a)},Planes.prototype.overlap=function(a){var b,c,d=this.children,e=d.length;if(d.length>0)for(c=0;e>c;c++)if(b=d[c],b.name!=this.stage.loader.ID_CRAZY_BIRD&&b.name!=this.stage.loader.ID_CRAZY_PLANE){var f=new Point(b.x,b.y);if(a.overlap(b))return void(b.hit(a)&&(b.name==this.stage.loader.ID_PLANE_BIRD?(this.crazyBird.setA(f,new Point(Utils.SLINGSHOT_X,Utils.SLINGSHOT_Y)),this.crazy=this.crazyBird):b.name==this.stage.loader.ID_CROW||(this.crazyPlane.setA(f,new Point(Utils.SLINGSHOT_X,Utils.SLINGSHOT_Y)),this.crazy=this.crazyPlane)))}},Planes.prototype.getCrazy=function(){return this.crazy},Planes.prototype.isCrazy=function(){return null!=this.crazy&&this.crazy.visible?!0:!1},Planes.prototype.initCrow=function(a){this.shit=a};var PaperPlane=function(a,b,c,d){var e=b.getResult(a);createjs.Sprite.call(this,e),this.x=0,this.y=0,this.scaleX=Utils.scale,this.scaleY=Utils.scale;var f=this.getTransformedBounds();this.regX=f.width/2,this.regY=f.height/2,this.setBounds(0+f.width/3,0+f.height/3,f.width/3,f.height/3),this.visible=!1,this.path=null,this.pi=0,this.w=f.width,this.h=f.height,this.name=a,this.lastPoint=null,this.speed=c||1,this.pathCount=Utils.STAGE_W/this.speed,this.level=d};PaperPlane.prototype=Object.create(createjs.Sprite.prototype),PaperPlane.prototype.constructor=PaperPlane,PaperPlane.prototype.loop=function(a){if(null!=this.path){var b=Utils.catmullRomInterpolation(this.path.x,this.pi/this.pathCount),c=Utils.catmullRomInterpolation(this.path.y,this.pi/this.pathCount),d=new Point(b,c),e=null===this.lastPoint?0:Utils.angleBetweenPoints(this.lastPoint,d);this.lastPoint=d,this.x=b,this.y=c,this.pi>this.pathCount/2?this.rotation=Utils.radToDeg(e-Math.PI):this.rotation=Utils.radToDeg(e),this.pi++,this.pi>=this.pathCount&&(this.pi=0),b>Utils.STAGE_W+this.w?this.gotoAndPlay("left"):b<0-this.w&&this.gotoAndPlay("right")}},PaperPlane.prototype.show=function(a,b){this.visible=!0,b?(this.pi=0,Utils.clearArray(this.path.paths),Utils.clearArray(this.path.x),Utils.clearArray(this.path.y)):this.pi=Math.floor(Math.random()*this.pathCount*2/4)+this.pathCount/4,this.path=a,this.pi<this.pathCount/2?this.gotoAndPlay("right"):this.pi>this.pathCount/2&&this.gotoAndPlay("left")},PaperPlane.prototype.drawPath=function(a){for(var b=0;b<this.path.paths.length;b++)a.rect(this.path.paths[b].x,this.path.paths[b].y,1,1);for(var b=0;b<this.path.x.length;b++)a.rect(this.path.x[b]-3,this.path.y[b]-3,6,6)},PaperPlane.prototype.getB=function(){var a,b,c,d=this.getTransformedBounds();return"fly_bird"==this.name,b=d.x+d.width/2-this.w/4,c=d.y+d.height/2-this.h/4,a=new createjs.Rectangle(b,c,this.w/2,this.h/2),a},PaperPlane.prototype.hit=function(a){console.log("overlap plane >> "+this.name),this.visible=!1,a.visible=!1,Utils.isBullet=!1,Utils.isTween||this.stage.bullets.reShow(),this.stage.planes.showOne(this,!0);var b=!1;return this.name==this.stage.loader.ID_PLANE_EMPTY?Utils.hitEmpty(this.stage.bullets.getStoneCount(),this.stage.bullets.getGoldCount()):b=Utils.getScroe(this.name,this.stage.bullets.getStoneCount(),this.stage.bullets.getGoldCount()),b};var Crow=function(a,b,c){PaperPlane.call(this,a,b),this.visible=!0,this.x=Utils.HALF_W,this.y=-150,this.life=new Life(100),this.life.setPosition(this.x,this.y+this.h/2),this.life.show(),this.life.setTarget(this),this.gotoAndPlay("fly"),this.realSpeed=this.speed,this.shit=c,this.initShit()};Crow.prototype=Object.create(PaperPlane.prototype),Crow.prototype.constructor=Crow,Crow.prototype.initShit=function(){null!=this.shit&&(this.shit.x=Utils.HALF_W,this.shit.speed.set(0,600),this.shit.visible=!0)},Crow.prototype.loop=function(a){this.y+=this.realSpeed,this.life.setPosition(this.x,this.y+this.h/2),this.y>=150?(this.realSpeed=-this.speed,null!=this.shit&&this.shit.visible?this.shit.y=this.y:console.log("乌鸦没石头了")):this.y<=-150&&(this.realSpeed=this.speed,this.shit.visible=!0)},Crow.prototype.show=function(){},Crow.prototype.hit=function(a){if(a.visible=!1,Utils.isBullet=!1,Utils.isTween||this.stage.bullets.reShow(),this.life.loss(a.power),this.life.isDie()){Utils.getScroe("crow",this.stage.bullets.getStoneCount(),this.stage.bullets.getGoldCount());var b=this;setTimeout(function(){console.log("crow boss reshow !!"),b.reShow()},6e4)}console.log("hit crow , hp > "+this.life.hp)},Crow.prototype.reShow=function(){this.visible=!0,this.y=-150,this.life.reShow(this.x,this.y)};var CrazyPlane=function(a,b){PaperPlane.call(this,a,b),this.ta=1,this.tx=1,this.ty=1,this.p1=null,this.p2=null,a==b.ID_CRAZY_BIRD?this.power=30:this.power=5,this.angle=0};CrazyPlane.prototype=Object.create(PaperPlane.prototype),CrazyPlane.prototype.constructor=CrazyPlane,CrazyPlane.prototype.setA=function(a,b){console.log(this.name+" is crazy !");var c=Utils.angleBetweenPoints(a,b);this.angle=this.rotation=Utils.radToDeg(c);var d=0;this.angle<90?(d=b.x-a.x,this.gotoAndPlay("right")):this.angle>90?(d=a.x-b.x,this.gotoAndPlay("left"),this.rotation-=180):(this.gotoAndPlay("left"),this.rotation-=180);var e=b.y-a.y,f=d/e;this.ta=f,this.tx=d,this.ty=e,this.x=a.x,this.y=a.y,this.visible=!0,this.p2=b,this.p1=a,console.log("x "+this.x+", y "+this.y+", angle"+this.rotation+", ta"+f)},CrazyPlane.prototype.loop=function(a){return this.y>=this.p2.y?void(this.visible=!1):(this.y+=10,void(this.angle<90?this.x=this.p1.x+this.ta*(this.y-this.p1.y):this.angle>90&&(this.x=this.p1.x-this.ta*(this.y-this.p1.y))))},CrazyPlane.prototype.overlap=function(a){var b=!1;return this.visible&&a.visible&&this.getB().intersects(a.getB())&&(a.hit(this),b=!0),b};var Bullet=function(a,b,c){createjs.Bitmap.call(this,a),this.speed=new Point(0,0),this.gravity=new Point(0,0),this.w=a.width,this.h=a.height,this.regX=this.w/2,this.regY=this.h/2,this.positionDown=new Point,this.position=new Point,this.cAngle=0,this.cDistance=0,this.maxDistance=Utils.maxDistance,this.baseSpeed=1e3,this.tspeed=1e3,this.baseGravityY=800,this.type=b,this.count=c,"stone"==this.type?this.power=1:"gold"==this.type?this.power=10:"shit"==this.type&&(this.power=2),this.name=this.type,this.moveCallback=null,this.emptyCallback=function(){},this.setBounds(this.w/10,this.h/10,4*this.w/5,4*this.h/5),this.isDown=!1};Bullet.prototype=Object.create(createjs.Bitmap.prototype),Bullet.prototype.constructor=Bullet,Bullet.prototype.loop=function(a){var b=a.delta/1e3,c=this.speed.y*b+this.gravity.y*b*b/2;c*=Utils.speedScale,this.speed.x=this.speed.x+this.gravity.x*b,this.speed.y=this.speed.y+this.gravity.y*b,this.x=this.x+this.speed.x*b,this.y=this.y+c},Bullet.prototype.down=function(a){this.count<=0||(this.isDown=!0,this.positionDown.set(a.stageX,a.stageY),this.position.set(a.stageX,a.stageY))},Bullet.prototype.up=function(a){if(!this.isDown)return!1;Utils.currentDistance=this.cDistance,this.gravity.y=this.baseGravityY;var b=this.baseSpeed+this.cDistance*this.tspeed/this.maxDistance;return Utils.velocityFromRotation(this.cAngle,-b,this.speed),Utils.isBulletFire=!0,this.isDown=!1,console.log("speed y"+this.speed.y),this.use(),!0},Bullet.prototype.move=function(a){this.isDown&&(this.position.set(a.stageX,a.stageY),this.cAngle=Utils.angleBetweenPoints(this.positionDown,this.position),this.cAngle<Math.PI/6||this.cAngle>5*Math.PI/6||(this.cDistance=Utils.distance(this.positionDown,this.position),this.cDistance=7*this.cDistance/18,this.cDistance=Math.min(this.cDistance,this.maxDistance),this.x=Utils.BULLET_X+Math.cos(this.cAngle)*this.cDistance,this.y=Utils.BULLET_Y+Math.sin(this.cAngle)*this.cDistance,null!=this.moveCallback&&this.moveCallback.c(new Point(this.x,this.y),this.cAngle,this.cDistance),this.rotation=Utils.radToDeg(this.cAngle-Math.PI/2)))},Bullet.prototype.reset=function(){return this.count<=0?void this.emptyCallback():(this.speed=new Point(0,0),this.gravity=new Point(0,0),this.visible=!0,this.setTransform(Utils.BULLET_X,Utils.BULLET_Y,Utils.scale,Utils.scale),this.regX=this.w/2,this.regY=this.h/2,this.cDistance=0,this.cAngle=0,void(Utils.isBullet=!0))},Bullet.prototype.getB=function(){return this.getTransformedBounds()},Bullet.prototype.use=function(){this.count--},Bullet.prototype.overlap=function(a){var b=!1;return this.visible&&a.visible&&this.getB().intersects(a.getB())&&(Utils.isBulletFire=!1,b=!0),b},Bullet.prototype.checkOutBounds=function(){var a=this.getB();(a.x+a.width<0||a.y+a.height<0||a.x>Utils.STAGE_W||a.y>Utils.STAGE_H)&&(console.log(this.type+"bullet is outbounds!!"),this.visible=!1,Utils.isBullet=!1,Utils.isBulletFire=!1,Utils.isTween||this.stage.bullets.reShow())};var BulletCount=function(a){createjs.Container.call(this);var b=new createjs.Bitmap(a);b.regX=a.width/2,b.regY=a.height/2,b.visible=!1,this.addChild(b);var c=new createjs.Text(""+this.bulletCount,"38pt verdana","#000");c.y=b.y,c.regY=a.height/2,c.visible=!1,this.addChild(c),this.count=b,this.hint=c,this.b=null};BulletCount.prototype=Object.create(createjs.Container.prototype),BulletCount.prototype.constructor=BulletCount,BulletCount.prototype.show=function(a,b){this.count.x=a,this.count.y=this.hint.y=b,this.hint.x=a+80,this.count.visible=!0,this.hint.visible=!0},BulletCount.prototype.setText=function(a){this.hint.text=a},BulletCount.prototype.setOnclickBounds=function(a){var b=this.getBounds();this.b=document.createElement("div"),this.b.className="click_bounds",this.b.style.left=b.x+"px",this.b.style.top=b.y+"px",this.b.style.width=b.width+"px",this.b.style.height=b.height+"px",this.b.onclick=a,document.body.appendChild(this.b)};var Bullets=function(){createjs.Container.call(this),this.baseSpeed=20,this.cacheBullet=null,this.stone=null,this.gold=null,this.shit=null,this.s=null,this.moveCallback=null,this.showCallback=null,this.shitInitCallback=function(a){},this.stoneCountUI=null,this.goldCountUI=null,this.bulletPointer=null,this.switchBullet=null,this.isFirstBulletEmpty=!1};Bullets.prototype=Object.create(createjs.Container.prototype),Bullets.prototype.constructor=Bullets,Bullets.prototype.initChild=function(a){var b=this.stage.loader;this.show(a);var c=b.getResult(b.ID_BULLET_COUNT),d=new BulletCount(c);d.show(100*Utils.scale,Utils.STAGE_H-80*Utils.scale),d.setText(a.bullet_count),this.addChild(d);var e=this;d.setOnclickBounds(function(){console.log("stone bullet switch"),e["switch"](!1)}),this.stoneCountUI=d;var f=b.getResult(b.ID_BULLET_GOLD_COUNT),g=new BulletCount(f);g.show(360*Utils.scale,Utils.STAGE_H-80*Utils.scale),g.setText(a.bullet_gold_count),this.addChild(g),g.setOnclickBounds(function(){console.log("gold bullet switch"),e["switch"](!0)}),this.goldCountUI=g;var h=b.getResult(b.ID_POINTER);console.log(h.toString()),this.bulletPointer=new createjs.Bitmap(h),this.bulletPointer.y=Utils.STAGE_H-185*Utils.scale,this.bulletPointer.x=80*Utils.scale,this.addChild(this.bulletPointer)},Bullets.prototype.show=function(){var a,b=this.stage.loader;a=b.getResult(b.ID_BULLET),Utils.BULLET_W=a.width*Utils.scale,Utils.BULLET_H=a.height*Utils.scale,Utils.BULLET_X=Utils.SLINGSHOT_X,Utils.BULLET_Y=Utils.SLINGSHOT_Y-50*Utils.scale;var c=new Bullet(a,"stone",data.bullet_count);c.setTransform(Utils.BULLET_X,Utils.BULLET_Y,Utils.scale,Utils.scale),c.visible=!1,this.addChild(c),c.moveCallback=this.moveCallback,this.stone=c;var d=b.getResult(b.ID_BULLET_GOLD),e=new Bullet(d,"gold",data.bullet_gold_count);e.setTransform(this.stone.x,this.stone.y,Utils.scale,Utils.scale),e.visible=!1,e.moveCallback=this.moveCallback,this.addChild(e),this.gold=e;var f=b.getResult(b.ID_SHIT),g=new Bullet(f,"shit",0);g.visible=!1,this.addChild(g),this.shit=g,this.shitInitCallback(g),this.switchBullet=this.cacheBullet=this.stone,this.reShow(),this.showCallback;var h=this,i=function(){h.noBullet()};this.stone.emptyCallback=i,this.gold.emptyCallback=i,console.log("speed dis "+(Utils.BULLET_Y-Utils.pathFactory.baseY)),Utils.speedScale=(Utils.BULLET_Y-Utils.pathFactory.baseY)/1370},Bullets.prototype.noBullet=function(){this.isFirstBulletEmpty?(console.log("第22222个子弹空"),Utils.noBullets()):(console.log("第一个子弹空"),this.isFirstBulletEmpty=!0,this["switch"](this.cacheBullet==this.stone))},Bullets.prototype.getShit=function(){return this.shit},Bullets.prototype["switch"]=function(a){if(a){if(this.gold.count<=0)return;this.bulletPointer.x=340*Utils.scale,this.switchBullet=this.gold}else{if(this.stone.count<=0)return;this.bulletPointer.x=80*Utils.scale,this.switchBullet=this.stone}Utils.isBulletFire||(this.cacheBullet.visible=!1,this.reShow())},Bullets.prototype.reShow=function(){this.cacheBullet=this.switchBullet,this.cacheBullet.reset()},Bullets.prototype.getStoneCount=function(){return this.stone.count},Bullets.prototype.getGoldCount=function(){return this.gold.count},Bullets.prototype.hasBulletVisile=function(){return this.cacheBullet.visible},Bullets.prototype.loop=function(a){null!=this.cacheBullet&&this.cacheBullet.loop(a),null!=this.shit&&this.shit.loop(a),null!=this.stoneCountUI&&this.stoneCountUI.setText(this.stone.count),null!=this.goldCountUI&&this.goldCountUI.setText(this.gold.count)},Bullets.prototype.down=function(a){null!=this.cacheBullet&&this.cacheBullet.down(a)},Bullets.prototype.up=function(a){return null!=this.cacheBullet?this.cacheBullet.up(a):!1},Bullets.prototype.move=function(a){null!=this.cacheBullet&&this.cacheBullet.move(a)};var Cloud=function(a){createjs.Bitmap.call(this,a),this.w=a.width,this.h=a.height,this.regX=this.w/2,this.regY=this.h/2,this.life=new Life(10),this.life.show(),this.life.setTarget(this),this.speed=1,this.realSpeed=this.speed,this.isTween=!1};Cloud.prototype=Object.create(createjs.Bitmap.prototype),Cloud.prototype.constructor=Cloud,Cloud.prototype.loop=function(a){this.visible&&!this.isTween&&(this.x+=this.realSpeed,this.setLifePostion(),this.realSpeed>0?this.x>Utils.STAGE_W-this.w/2&&(this.realSpeed=-this.speed):this.x<this.w/2&&(this.realSpeed=this.speed))},Cloud.prototype.hit=function(a){console.log("overlag cloud"),a.visible=!1,Utils.isBullet=!1,Utils.isTween||this.bullets.reShow(),this.life.loss(a.power,!0);var b=this.life.getRate();0>=b&&(b=.1);var c=this.y,d=5,e=createjs.Tween.get(this);this.isTween=!0,e.to({y:c-d},100,createjs.Ease.getPowIn(2)).to({y:c+d},200,createjs.Ease.getPowOut(2)).to({
y:c-d},200,createjs.Ease.getPowIn(2)).to({y:c+d},200,createjs.Ease.getPowOut(2)).to({alpha:b},500,createjs.Ease.getPowInOut(2)),e.call(this.checkVisible,[],this)},Cloud.prototype.checkVisible=function(){if(this.isTween=!1,this.life.showTween(),this.life.isDie()){console.log("cloud is die!!!"),Utils.getScroe("cloud",this.stage.bullets.getStoneCount(),this.stage.bullets.getGoldCount());var a=this;setTimeout(function(){console.log("cloud reshow !!"),a.reShow()},3e4)}},Cloud.prototype.setLifePostion=function(){var a=this.x,b=this.y+this.h/2;this.life.setPosition(a,b)},Cloud.prototype.getB=function(){var a=this.getTransformedBounds();return a},Cloud.prototype.reShow=function(){this.visible=!0,this.alpha=1,this.x=this.w,this.life.reShow(this.x,this.y)};var Clouds=function(){createjs.Container.call(this)};Clouds.prototype=Object.create(createjs.Container.prototype),Clouds.prototype.constructor=Clouds,Clouds.prototype.initChild=function(){var a=this.stage.loader,b=a.getResult(a.ID_CLOUD),c=new Cloud(b);c.x=Utils.HALF_W,c.y=Utils.SLINGSHOT_Y-500*Utils.scale,c.setLifePostion(),this.addChild(c)},Clouds.prototype.loop=function(a){var b,c=this.children.length;for(b=0;c>b;b++)this.getChildAt(b).loop(a)},Clouds.prototype.overlap=function(a){var b,c,d=this.children,e=d.length;if(d.length>0)for(c=0;e>c;c++)if(b=d[c],a.overlap(b))return void b.hit(a)};var CoreStage=function(a,b){createjs.Stage.call(this,a),Utils.STAGE_W=this.canvas.width,Utils.STAGE_H=this.canvas.height,Utils.HALF_W=Utils.STAGE_W/2,Utils.HALF_H=Utils.STAGE_H/2,this.data=b,this.loader=new ResourceLoader,this.loader.on("complete",this.loaderComplete,this),this.loader.on("progress",this.loaderProgress,this),this.staticContainer=new StaticContainer,this.bullets=new Bullets,this.planes=new Planes,this.rubber=new RubberContainer,this.clouds=new Clouds,this.debugShape=new createjs.Shape,this.pathShape=new createjs.Shape,this.loaddom=new LoaderDOM,this.fps=new createjs.Text("","36px Arial","#777"),this.movetext=new createjs.Text("","26px Arial","#777"),this.loadWidth=.7*Utils.STAGE_W,this.preLoad(),this.loader.startLoad()};CoreStage.prototype=Object.create(createjs.Stage.prototype),CoreStage.prototype.constructor=CoreStage,CoreStage.prototype.loaderComplete=function(){this.loaddom.destory(),this.addChild(this.staticContainer),this.addChild(this.planes),this.addChild(this.bullets),this.staticContainer.initChild(),this.bullets.initChild(this.data),this.planes.initChild(this.data),this.addChild(this.rubber),this.rubber.initChild(),this.addChild(this.clouds),this.clouds.initChild(),Utils.debugF&&(this.fps.x=Utils.HALF_W,this.fps.y=50,this.addChild(this.fps)),Utils.isDebug&&(this.movetext.x=100,this.movetext.y=100,this.addChild(this.movetext),this.addChild(this.debugShape)),this.update()},CoreStage.prototype.startLoop=function(){createjs.Ticker.framerate=60,createjs.Ticker.on("tick",this.loop,this),createjs.Touch.enable(this,!0),this.on("stagemousedown",this.down,this),this.on("stagemouseup",this.up,this),this.on("stagemousemove",this.move,this);var a=function(a,b,c){this.rubber.drawRubber(a,b,c)};this.bullets.moveCallback=new Callback(a,this),this.bullets.showCallback=new Callback(a,this);var b=this;this.bullets.shitInitCallback=function(a){b.planes.initCrow(a)},this.rubber.tweenComplete=function(){Utils.isTween=!1,Utils.isBullet||this.bullets.reShow()},this.rubber.tweenCompleteContext=this},CoreStage.prototype.loop=function(a){Utils.pause||(this.bullets.loop(a),this.planes.loop(a),this.clouds.loop(a),this.update(a),Utils.debugB&&this.debug(),Utils.debugF&&(this.fps.text="fps:"+createjs.Ticker.getMeasuredFPS().toFixed(2)),this.overlap(),this.checkOutBounds())},CoreStage.prototype.down=function(a){a.stageY<2*Utils.STAGE_H/3||a.stageX<Utils.SLINGSHOT_X-Utils.SLINGSHOT_W/2||a.stageX>Utils.SLINGSHOT_X+Utils.SLINGSHOT_W/2||Utils.isBulletFire||Utils.isScore||!this.bullets.hasBulletVisile()||this.bullets.down(a)},CoreStage.prototype.up=function(a){this.bullets.cacheBullet.positionDown.y<2*Utils.STAGE_H/3||this.bullets.cacheBullet.position.y<2*Utils.STAGE_H/3||Utils.isBulletFire||Utils.isScore||this.bullets.up(a)&&this.rubber.up(a)},CoreStage.prototype.move=function(a){Utils.isBulletFire||Utils.isScore||this.bullets.move(a)},CoreStage.prototype.overlap=function(){var a=this.bullets.cacheBullet,b=this.planes.children;this.clouds.children;null!=a&&null!=b&&(this.staticContainer.overlap(this.bullets.getShit()),this.planes.isCrazy()&&this.staticContainer.overlap(this.planes.getCrazy()),this.clouds.overlap(a),this.planes.overlap(a))},CoreStage.prototype.checkOutBounds=function(){var a=this.bullets.cacheBullet;null!=a&&a.visible&&a.checkOutBounds()},CoreStage.prototype.debug=function(){var a=this.debugShape.graphics;a.clear(),a.setStrokeStyle(1,"round","round"),a.beginStroke("#F0F");var b,c,d=this.planes.children;if(null!=d){if(Array.isArray(d)&&d.length>0)for(b=0;b<d.length;b++)c=d[b],c.visible&&a.append(Utils.rectangleToRect(c.getB()));null!=this.bullets.cacheBullet&&this.bullets.cacheBullet.visible&&a.append(Utils.rectangleToRect(this.bullets.cacheBullet.getB()))}},CoreStage.prototype.debugDrawPath=function(){var a=this.pathShape.graphics;a.setStrokeStyle(1,"round","round"),a.beginStroke("#01DF01"),this.planes.drawPath(a),a.rect(Utils.STAGE_W/2,0,1,Utils.STAGE_H),a.beginStroke("#DF013A"),a.rect(Utils.SLINGSHOT_X,Utils.SLINGSHOT_Y,3,3)},CoreStage.prototype.preLoad=function(){this.loaddom.add()},CoreStage.prototype.loaderProgress=function(a){var b=a.loaded*(this.loadWidth-30)+30;this.loaddom.progress(b)};var stage,data;Utils.isDebug&&(window.onload=function(){startGame()});